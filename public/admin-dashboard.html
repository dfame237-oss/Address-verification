<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script>
        // Custom Tailwind config using the consistent 'tf-' palette
        tailwind.config = {
            theme: {
                extend: {
          

           colors: {
                        'tf-dark': '#0F172A', // Deep Blue-Gray Background
                        'tf-primary': '#6366F1', // Indigo/Violet Primary Accent
                        'tf-secondary': '#06B6D4', // Cyan Secondary Accent
 
 
                        'tf-text': '#E2E8F0', // Light Text
                        'tf-card': '#1E293B', // Darker Card Background
                        'tf-light': '#F1F5F9', // Very light gray for
            
  
           'alert-dark': '#DC2626',
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                }
            }
        }
    </script>
 
   
<style>
// ... [Lines 514 - 581 unchanged]

        </header>

        <div id="inbox-modal" class="modal">
// ... [Lines 582 - 601 unchanged]

    </div>

    <script>
        // --- PLAN & PRICING DATA MODEL (Assuming this is sourced 
 from a separate file: pubic pricing data js.txt) ---
        const PLANS = [
            { name: 'Growth Starter', basePrice: 1000, credits: '10,000' },
            { name: 'Business Pro', basePrice: 2000, credits: '25,000' },
          
  { name: 'Enterprise Max', basePrice: 5000, credits: 'Unlimited' },
        ];
const DURATIONS = [
            { months: 1, label: "1 Month", discount: 0 },
            { months: 3, label: "3 Months", discount: 0.20 },
            { months: 6, label: "6 Months", discount: 0.30 },
            { months: 12, label: "1 Year", discount: 0.40 },
        ];
function calculatePrice(basePrice, months, discount) {
            const monthlyTotal = basePrice * months;
const discountedTotal = monthlyTotal * (1 - discount);
            return Math.round(discountedTotal * 1.18);
// 18% GST
        }
        
        // --- CONSTANTS AND UTILS ---
        const API_BASE = '/api';
const AUTH_TOKEN = localStorage.getItem('adminToken');
        const ADMIN_ID = 'admin'; 
        let activeClients = [];
        let selectedClientId = null; 
        let selectedClientUsername = null;
let currentInboxTab = 'messages';
        const ONLINE_THRESHOLD_MS = 300000; // 5 minutes in milliseconds - Defines "Online" status

        // Check auth status on load
        if (!AUTH_TOKEN) {
            window.location.href = 'admin-login.html';
}
        
        function logout() {
            localStorage.removeItem('adminToken');
window.location.href = 'admin-login.html';
        }
        
        // --- UI GENERATION (UPDATED for Credits) ---
        function generatePlanOptions() {
            const options = [];
PLANS.forEach(plan => {
                DURATIONS.forEach(duration => {
                    const finalPrice = calculatePrice(plan.basePrice, duration.months, duration.discount);
                    
                    // Format: PlanName_Price_DurationMonths_Month_Credits (e.g., Growth Starter_1180_1_Month_10,000)
          

           const value = `${plan.name}_${finalPrice}_${duration.months}_Month_${plan.credits}`; 
                    const label = `${plan.name} (${plan.credits} Crs) - â‚¹${finalPrice} (${duration.label}${duration.discount > 0 ? ` - ${duration.discount*100}% OFF` : ''})`;
                    
                    options.push(`<option value="${value}">${label}</option>`);
       
   
       });
            });
return options.join('');
        }
        
        function populatePlanDropdowns() {
// ... [Lines 615 - 617 unchanged]
                updateValidityDate(e.target.value, 'update-validity');
            });
// Auto-set the date for the default selected plan on load
            const defaultAddPlanValue = document.getElementById('add-plan').value;
if (defaultAddPlanValue) updateValidityDate(defaultAddPlanValue, 'add-validity');
        }

        // --- CORE FUNCTION TO CALCULATE AND SET VALIDITY DATE (Corrected) ---
// ... [Lines 620 - 641 unchanged]
        }


        function renderClients(clients) {
            const clientListBody = document.getElementById('client-list');
clientListBody.innerHTML = '';

            if (clients.length === 0) {
// ... [Lines 643 - 644 unchanged]
                    ? `<span class="status-enabled">Enabled</span>` 
                    : `<span class="status-disabled">Disabled</span>`;
 

                
                const onlineStatusHtml = formatLastActive(client.lastActivityAt);
                
                // Extract plan name and credits from the full planName string
                // Format: PlanName_Price_DurationMonths_Month_Credits
     
           const planParts = client.planName ? client.planName.split('_') : ['N/A', 'N/A', 'N/A', 'N/A', 'N/A'];
                const planDisplay = planParts[0];
                const creditsDisplay = planParts[4] || 'N/A';
 
                
                const row = `
  
                  <tr class="transition duration-150 ease-in-out hover:bg-gray-50">
                        <td class="font-semibold text-gray-900">${client.username}</td>
              
   
                        <td>${client.clientName ||
'N/A'}<br><span class="text-sm text-gray-500">${client.email || 'N/A'}</span></td>
                        <td>${planDisplay}<br><span class="text-xs font-semibold text-tf-secondary">${creditsDisplay} Credits</span><br><span class="text-sm text-gray-500">${new Date(client.validityEnd).toLocaleDateString()}</span></td>
                        <td>${statusBadge}</td>
                 
                <td class="text-sm font-medium flex items-center">${onlineStatusHtml}</td>
    
   
                        <td>
                            <button class="action-btn" onclick="openUpdateModal('${client._id}')"><i class="fas fa-edit"></i> Edit</button>
                         
    <button class="action-btn delete" onclick="deleteClient('${client._id}')"><i class="fas fa-trash-alt"></i> Remove</button>
     
           
                            <button class="action-btn modal-button" onclick="openReplyForm('${client._id}', '${client.username}')"><i class="fas fa-reply"></i> Message</button>
                        </td>
                
     </tr>
         
       `;
 clientListBody.insertAdjacentHTML('beforeend', row);
            });
}
// ... [Lines 652 - 757 unchanged]